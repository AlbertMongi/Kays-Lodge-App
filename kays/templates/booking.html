{% extends 'base.html' %}
 {% load static %} 
 
 {% block content %}
 <div class="container-xxl bg-white p-0">
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->


    <!-- Page Header Start -->
    <div  class="container-fluid page-header mb-5 p-0" style="background-image: url('{% static "img/carousel-1.jpg" %}');">
        <div class="container-fluid page-header-inner py-5">
            <div class="container text-center pb-5">
                <h1 class="display-3 text-white mb-3 animated slideInDown">Reservation </h1>
                <nav aria-label="breadcrumb">
                    <!-- <ol class="breadcrumb justify-content-center text-uppercase">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Pages</a></li>
                        <li class="breadcrumb-item text-white active" aria-current="page">About</li>
                    </ol> -->
                </nav>
            </div>
        </div>
    </div>
    <!-- Page Header End -->
<!-- Booking Start -->
     
<div class="container-xxl py-5">
    <div class="container">
        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
            <h6 class="section-title text-center text-primary text-uppercase">Room Reservation</h6>
            <h1 class="mb-5">Reserve A <span class="text-primary text-uppercase">Luxury Room</span></h1>
        </div>
        <div class="row g-5">
            <div class="col-lg-6">
                <div class="row g-3">
                    <div class="col-6 text-end">
                        <img class="img-fluid rounded w-75 wow zoomIn" data-wow-delay="0.1s" src="{% static 'img/about-5.jpg' %}" style="margin-top: 25%';">
                    </div>
                    <div class="col-6 text-start">
                        <img class="img-fluid rounded w-100 wow zoomIn" data-wow-delay="0.3s" src="{% static 'img/about-6.jpg' %}">
                    </div>
                    <div class="col-6 text-end">
                        <img class="img-fluid rounded w-50 wow zoomIn" data-wow-delay="0.5s" src="{% static 'img/about-7.jpg' %}">
                    </div>
                    <div class="col-6 text-start">
                        <img class="img-fluid rounded w-75 wow zoomIn" data-wow-delay="0.7s" src="{% static 'img/about-8.jpg' %}">
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="wow fadeInUp" data-wow-delay="0.2s">
                    <form method="post" action="{% url 'booking' %}">
                        {% csrf_token %}
                      
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" name="name" class="form-control" id="name" placeholder="Your Name">
                                    <label for="name">First Name</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" name="surname" class="form-control" id="surname" placeholder="Your Surname">
                                    <label for="surname">Surname</label>
                                </div>
                            </div>
                            <div class='col-md-6'>
                                <div class="form-group">
                                    <div class="input-group date" id="checkin" data-target-input="nearest">
                                        <input type="text" name="check_in" placeholder="Check In" class="form-control datetimepicker-input" data-target="#checkin"/>
                                        <div class="input-group-append" data-target="#checkin" data-toggle="datetimepicker">
                                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class='col-md-6'>
                                <div class="form-group">
                                    <div class="input-group date" id="checkout" data-target-input="nearest">
                                        <input type="text" name="check_out" placeholder="Check Out" class="form-control datetimepicker-input" data-target="#checkout"/>
                                        <div class="input-group-append" data-target="#checkout" data-toggle="datetimepicker">
                                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="email" name="email" class="form-control" id="email" placeholder="Your Email">
                                    <label for="email">Your Email</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select name="number_of_guests" class="form-select" id="number">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                    </select>
                                    <label for="number">Number of Guests</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select name="available_rooms" class="form-select" id="available-rooms">
                                        <!-- <option selected disabled>Available Rooms</option> -->
                                        {% if available_rooms %}
                                            {% for room in available_rooms %}
                                                <option value="{{ room.id }}">{{ room.number }}</option>
                                            {% endfor %}
                                        {% else %}
                                            <option value="" disabled>No available rooms</option>
                                        {% endif %}
                                    </select>
                                    <label for="available-rooms">Available Rooms</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea name="special_request" class="form-control" placeholder="Special Request" id="special_request" style="height: 100px"></textarea>
                                    <label for="special_request">Special Request</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="my-3"></div>
                    
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <button class="btn btn-primary w-100 py-3" type="submit">Reserve Room</button>
                            </div>
                            <div class="col-md-6">
                                <!-- Additional content if needed -->
                            </div>
                        </div>
                    </form>                    
    </div>
</di>
    </div>
</div>
     
    </div>
</div>

<!-- Booking End -->

<!-- <h2>Accepted Payment Methods</h2>
<div class="payment-methods"> -->
    <!-- PayPal -->
    <!-- <div class="payment-method">
        <img src="https://www.paypalobjects.com/webstatic/mktg/logo/AM_mc_vs_dc_ae.jpg" alt="PayPal">
    </div> -->

<!-- Newsletter Start -->
<div class="container newsletter mt-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="row justify-content-center">
        <div class="col-lg-10 border rounded p-1">
            <div class="border rounded text-center p-1">
                <div class="bg-white rounded text-center p-5">
                    <h4 class="mb-4">Subscribe Our <span class="text-primary text-uppercase">Newsletter</span></h4>
                    <form method="post" action="{% url 'booking' %}">
                        {% csrf_token %}
                        
                        <div class="position-relative mx-auto" style="max-width: 400px;">
                            <input name="email" class="form-control w-100 py-3 ps-4 pe-5" type="email" placeholder="Enter your email">
                        
                            <button type="submit" class="btn btn-primary py-2 px-3 position-absolute top-0 end-0 mt-2 me-2">Submit</button>
                        </div>
                        {% if success_message %}
            <div class="success-message" style="color: rgb(243, 169, 9);">{{ success_message }}</div>
            {% endif %}
                    </form>                        
                </div>
                
            </div>
            
        </div>
    </div>
</div>

<!--Calendar Javascript Validation-->
   <!-- <script type="text/javascript">
       $(function () {
           $('#checkin').datetimepicker();
           $('#checkout').datetimepicker({
               useCurrent: false
           });
   
           $("#checkin").on("change.datetimepicker", function (e) {
               $('#checkout').datetimepicker('minDate', e.date);
           });

           $('#checkin').on('change.datetimepicker', function(e){
            let dateObject = new Date(e.date._d)
            const day = dateObject.getDate()
            const month = dateObject.getMonth() + 1
            const year = dateObject.getFullYear()

            const checkinDate = `${day}-${month}-${year}`

            $(document).ready(function(){
                console.log('reday for ajax')
            })
           })
       });
   </script> -->

   <script type="text/javascript">
    $(document).ready(function(){
        $('#checkin').datetimepicker();
           $('#checkout').datetimepicker({
               useCurrent: false
           });
   
           $("#checkin").on("change.datetimepicker", function (e) {
            $('#checkout').datetimepicker('minDate', e.date);
        });

        $('#checkin').on('change.datetimepicker', function(e){
            let dateObject = new Date(e.date._d)
            const day = dateObject.getDate()
            const month = dateObject.getMonth() + 1
            const year = dateObject.getFullYear()

            const checkinDate = `${day}-${month}-${year}`

    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + "=")) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
        }
        }
    }
         return cookieValue;
}

            $.ajax({
                url: "http://127.0.01:8000/booking/available-rooms",
                method: 'POST',
                dataType: 'json',
                headers: {
                    "X-CSRFToken": getCookie("csrftoken"), 
                },
                data: JSON.stringify({
                    check_in: checkinDate
                }),
                success: function(data) {
                    console.log('response data', data)
                },
                error: function(xhr, status, error) {
                    console.log('an error occured ', error.mesasage)
                }
            })

        })
    })
   </script>

     <!-- validate checkout dates -->
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

{% endblock %}

 