<!-- booking_confirmation_email.html -->

<!DOCTYPE html>
<html>
<head>
    <title>Booking Confirmation</title>
</head>
<body>
    <h2>Booking Confirmation</h2>
    <p>Dear {{ user_name }},</p>
    <p>Thank you for booking a {{ room_type }}. Your booking details are as follows:</p>
    <ul>
        <li>Name: {{ user_name }}</li>
        <li>Email: {{ user_email }}</li>
        <li>Check-in: {{ check_in }}</li>
        <li>Check-out: {{ check_out }}</li>
        <li>Room Type: {{ room_type }}</li>
        <li>Special Requests: {{ special_requests }}</li>
    </ul>
    <p>We look forward to welcoming you!</p>
</body>
</html>


import paypalcheckoutsdk.core as paypalrestsdk

paypalrestsdk.configure({
    "mode": settings.PAYPAL_MODE,
    "client_id": settings.PAYPAL_CLIENT_ID,
    "client_secret": settings.PAYPAL_CLIENT_SECRET
})

def book(request):
    if request.method == 'POST':
        form = BookingForm(request.POST)
        if form.is_valid():
            booking = form.save()
            payment = paypalrestsdk.Payment({
                "intent": "sale",
                "payer": {
                    "payment_method": "paypal"
                },
                "redirect_urls": {
                    "return_url": request.build_absolute_uri(reverse('payment_success')),
                    "cancel_url": request.build_absolute_uri(reverse('payment_cancel'))
                },
                "transactions": [{
                    "item_list": {
                        "items": [{
                            "name": "Booking Payment",
                            "sku": "booking001",
                            "price": "10.00",  # Change this to the booking amount
                            "currency": "USD",
                            "quantity": 1
                        }]
                    },
                    "amount": {
                        "total": "10.00",  # Change this to the booking amount
                        "currency": "USD"
                    },
                    "description": "Booking Payment"
                }]
            })
            if payment.create():
                for link in payment.links:
                    if link.method == "REDIRECT":
                        redirect_url = str(link.href)
                        return redirect(redirect_url)
            else:
                print(payment.error)
                return JsonResponse({'error': payment.error}, status=500)
    else:
        form = BookingForm()
    return render(request, 'book.html', {'form': form})

def payment_success(request):
    # Handle successful payment
    return render(request, 'payment_success.html')

def payment_cancel(request):
    # Handle canceled payment
    return render(request, 'payment_cancel.html')



    